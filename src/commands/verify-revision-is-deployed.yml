description: >
  Polls the service''s deployment status at intervals until the given
  task definition revision is the only one deployed for the service, and for the
  task definition revision''s running task count to match the desired count.
  Does not support ECS services that are of the Blue/Green Deployment type.
parameters:
  cluster-name:
    description: The short name or full ARN of the cluster that hosts the service.
    type: string
  fail-on-verification-timeout:
    default: true
    description: >
      Whether to exit with an error if the verification of the deployment
      status does not complete within the number of polling attempts.
    type: boolean
  family:
    description: Name of the task definition's family.
    type: string
  max-poll-attempts:
    default: 50
    description: >
      The maximum number of attempts to poll for the deployment status
      before giving up.
    type: integer
  poll-interval:
    default: 20
    description: The polling interval, in seconds.
    type: integer
  service-name:
    default: ''
    description: >
      The name of the service to update. If undefined, we assume `family`
      is the name of both the service and task definition.
    type: string
  task-definition-arn:
    description: ARN of the task definition whose deployment status is to be monitored.
    type: string
steps:
- run:
    name: Verify that the revision is deployed and older revisions are stopped
    command: <<include(scripts/verify-revision.sh)>>
    description: >
      Poll the deployment status at intervals till the given task definition
      revision has reached its desired running task count and is the only
      one deployed for the service.
