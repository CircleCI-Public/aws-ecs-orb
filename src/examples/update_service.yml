description: |
  Use the AWS CLI and this orb to update an ECS service.
  (Supports both EC2 and Fargate launch types)
usage:
  version: 2.1
  orbs:
    aws-cli: circleci/aws-cli@3.1
    aws-ecs: circleci/aws-ecs@4.0
  jobs:
    update-tag:
      docker:
        - image: cimg/python:3.10
      steps:
        - aws-cli/setup:
            # This example uses CircleCI's OpenID Connect Token to generate temporary AWS keys
            role-arn: "arn:aws:iam::123456789012:role/OIDC_ARN"
            region: AWS_REGION
            profile_name: "OIDC-PROFILE"
            session-duration: 3600
            role-session-name: "example-session-name"
        - aws-ecs/update_service:
            family: '${MY_APP_PREFIX}-service'
            cluster: '${MY_APP_PREFIX}-cluster'
            container_image_name_updates: 'container=${MY_APP_PREFIX}-service,tag=stable'
  workflows:
    deploy:
      jobs:
        - update-tag:
            context: [CircleCI_OIDC_Token]
